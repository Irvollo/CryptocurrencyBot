{"version":3,"sources":["../index.node.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;GAcG;;AAEH,qCAAqC;AACrC,uCAAsD;AAGtD,+CAA8C;AAuErC,mBAvEA,mBAAQ,CAuEA;AAtEjB,yCAAwC;AAsErB,gBAtEV,aAAK,CAsEU;AArExB,iDAAgD;AAqEtB,oBArEjB,qBAAS,CAqEiB;AApEnC,6CAAqD;AAoEhB,wBApE5B,oBAAa,CAoE4B;AAnElD,sDAAqD;AACrD,6CAA+C;AAC/C,mDAAqD;AACrD,6BAA2B;AAG3B;;;;;;GAMG;AAEH,IAAM,WAAW,GAAG,mBAAQ,CAAC,WAAW,CAAC;AAqDW,kCAAW;AAnD/D,wBAA+B,GAAG,EAAE,GAAG,EAAE,OAAgB;IACvD;;;OAGG;IACH,gBAAS,CAAC,UAAU,GAAG,IAAI,CAAC;IAC5B,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;QACZ,aAAQ,CAAC,WAAW,GAAG,OAAO,CAAC;IACjC,CAAC;IAED,MAAM,CAAC;QACL,QAAQ,EAAE,yBAAW,CAAC,WAAW,EAAE,CAAC,eAAe,CAAC,GAAG,EAAE,GAAG,CAAC;QAC7D,SAAS,EAAE;YACT,SAAS,uBAAA;YACT,KAAK,eAAA;YACL,QAAQ,qBAAA;YACR,aAAa,sBAAA;YACb,QAAQ,UAAA;YACR,WAAW,aAAA;YACX,WAAW,aAAA;SACZ;KACF,CAAC;AACJ,CAAC;AAtBD,wCAsBC;AAED,0BAAiC,QAA2B;IAC1D,+DAA+D;IAC/D,IAAM,SAAS,GAAI,QAA+B,CAAC,QAAQ,CAAC,eAAe,CACzE,UAAU,EACV,UAAC,GAAG,EAAE,MAAM,EAAE,GAAG,IAAK,OAAA,yBAAW,CAAC,WAAW,EAAE,CAAC,eAAe,CAAC,GAAG,EAAE,GAAG,CAAC,EAAnD,CAAmD;IACzE,yCAAyC;IACzC;QACE,SAAS,uBAAA;QACT,KAAK,eAAA;QACL,QAAQ,qBAAA;QACR,aAAa,sBAAA;QACb,QAAQ,UAAA;QACR,WAAW,aAAA;QACX,WAAW,aAAA;KACZ,EACD,IAAI,EACJ,IAAI,CACL,CAAC;IAEF,EAAE,CAAC,CAAC,gBAAS,EAAE,CAAC,CAAC,CAAC;QAChB,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,EAAE,EAAE,cAAc,gBAAA,EAAE,CAAC,CAAC;IACpE,CAAC;AACH,CAAC;AAtBD,4CAsBC;AAED,gBAAgB,CAAC,aAAQ,CAAC,CAAC;AAK3B,uDAAsD;AAA7C,sCAAA,YAAY,CAAA;AACrB,uDAAsD;AAA7C,sCAAA,YAAY,CAAA","file":"index.node.js","sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from '@firebase/app';\nimport { CONSTANTS, isNodeSdk } from '@firebase/util';\nimport { FirebaseApp, FirebaseNamespace } from '@firebase/app-types';\nimport { _FirebaseNamespace } from '@firebase/app-types/private';\nimport { Database } from './src/api/Database';\nimport { Query } from './src/api/Query';\nimport { Reference } from './src/api/Reference';\nimport { enableLogging } from './src/core/util/util';\nimport { RepoManager } from './src/core/RepoManager';\nimport * as INTERNAL from './src/api/internal';\nimport * as TEST_ACCESS from './src/api/test_access';\nimport './src/nodePatches';\nimport * as types from '@firebase/database-types';\n\n/**\n * A one off register function which returns a database based on the app and\n * passed database URL.\n *\n * @param app A valid FirebaseApp-like object\n * @param url A valid Firebase databaseURL\n */\n\nconst ServerValue = Database.ServerValue;\n\nexport function initStandalone(app, url, version?: string) {\n  /**\n   * This should allow the firebase-admin package to provide a custom version\n   * to the backend\n   */\n  CONSTANTS.NODE_ADMIN = true;\n  if (version) {\n    firebase.SDK_VERSION = version;\n  }\n\n  return {\n    instance: RepoManager.getInstance().databaseFromApp(app, url),\n    namespace: {\n      Reference,\n      Query,\n      Database,\n      enableLogging,\n      INTERNAL,\n      ServerValue,\n      TEST_ACCESS\n    }\n  };\n}\n\nexport function registerDatabase(instance: FirebaseNamespace) {\n  // Register the Database Service with the 'firebase' namespace.\n  const namespace = (instance as _FirebaseNamespace).INTERNAL.registerService(\n    'database',\n    (app, unused, url) => RepoManager.getInstance().databaseFromApp(app, url),\n    // firebase.database namespace properties\n    {\n      Reference,\n      Query,\n      Database,\n      enableLogging,\n      INTERNAL,\n      ServerValue,\n      TEST_ACCESS\n    },\n    null,\n    true\n  );\n\n  if (isNodeSdk()) {\n    module.exports = Object.assign({}, namespace, { initStandalone });\n  }\n}\n\nregisterDatabase(firebase);\n\n// Types to export for the admin SDK\nexport { Database, Query, Reference, enableLogging, ServerValue };\n\nexport { DataSnapshot } from './src/api/DataSnapshot';\nexport { OnDisconnect } from './src/api/onDisconnect';\n\ndeclare module '@firebase/app-types' {\n  interface FirebaseNamespace {\n    database?: {\n      (app?: FirebaseApp): types.FirebaseDatabase;\n      enableLogging: typeof types.enableLogging;\n      ServerValue: types.ServerValue;\n      Database: typeof types.FirebaseDatabase;\n    };\n  }\n  interface FirebaseApp {\n    database?(): types.FirebaseDatabase;\n  }\n}\n"]}